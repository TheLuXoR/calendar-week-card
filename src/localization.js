export const FALLBACK_LANGUAGE = "en";

export const TRANSLATIONS = {
    en: {
        today: "Today",
        allDay: "All day",
        allDayShort: "All-day",
        allDayAbbrev: "All",
        location: "Location",
        description: "Description",
        calendarColors: "Calendar Colors",
        supportViaPaypal: "Like the card?",
        saveAndClose: "Save & Close",
        close: "Close",
        calendar: "Calendar",
        start: "Start",
        end: "End",
        noTitle: "(no title)",
        languageLabel: "Language",
        systemDefault: "System default",
        supportWithPaypal: "Support",
        highlightToday: "Highlight current day",
        highlightTodayDescription: "Shade today's column with a subtle color.",
        themeLabel: "Appearance",
        themeSystem: "Match system",
        themeLight: "Light",
        themeDark: "Dark",
        resetData: "Reset stored data",
        resetDataDescription: "Remove saved colors, language, highlight, and theme preferences.",
        resetConfirmation: "Clear stored calendar settings? This cannot be undone.",
        trimUnusedHours: "Trim blank hours",
        trimUnusedHoursDescription: "Hide early and late hours without events.",
        daysToShow: "Days to show",
        daysToShowDescription: "Limit the number of visible days (1–7).",
        noCalendarsTitle: "No calendars found",
        noCalendarsDescription: "Home Assistant has not registered any calendar entities yet, so the card has nothing to display.",
        noCalendarsStepsIntro: "To fix this, please:",
        noCalendarsStepIntegrations: "Open Settings → Devices & Services → Integrations.",
        noCalendarsStepAdd: "Add a calendar integration such as Local Calendar, Google Calendar, CalDAV, or any other provider you use.",
        noCalendarsStepVerify: "Wait until at least one `calendar.*` entity appears, then return to this dashboard and refresh the card.",
        noCalendarsLinksTitle: "Need help?",
        noCalendarsOpenIntegrations: "Open Integrations",
        noCalendarsReadGuide: "Read setup guide",
        noCalendarsRefresh: "Check again",
        noCalendarsSettingsHint: "You can set up this card from its own settings dialog. Use the gear icon in the header once Home Assistant finds calendars.",
        pickerLanguageHelper: "Use the same language as Home Assistant or pick one of the available translations.",
        pickerCalendarsTitle: "Calendars to include",
        pickerCalendarsDescription: "Toggle which calendars should appear in this card.",
        pickerCalendarsEmpty: "Home Assistant has not provided any calendars yet. Open Settings → Devices & Services → Integrations to add one or read the setup guide in the documentation for detailed steps.",
        pickerCalendarsLoading: "Looking for calendars…"
    },
    de: {
        today: "Heute",
        allDay: "Ganztägig",
        allDayShort: "Ganztäg.",
        allDayAbbrev: "Tag",
        location: "Ort",
        description: "Beschreibung",
        calendarColors: "Kalenderfarben",
        supportViaPaypal: "Gefällt dir die Karte?",
        saveAndClose: "Speichern & Schließen",
        close: "Schließen",
        calendar: "Kalender",
        start: "Beginn",
        end: "Ende",
        noTitle: "(kein Titel)",
        languageLabel: "Sprache",
        systemDefault: "Systemstandard",
        supportWithPaypal: "Unterstützen",
        highlightToday: "Aktuellen Tag hervorheben",
        highlightTodayDescription: "Markiert die heutige Spalte mit einer sanften Farbe.",
        themeLabel: "Darstellung",
        themeSystem: "System übernehmen",
        themeLight: "Hell",
        themeDark: "Dunkel",
        resetData: "Gespeicherte Daten zurücksetzen",
        resetDataDescription: "Entfernt gespeicherte Farben, Sprache, Hervorhebung und Theme-Einstellungen.",
        resetConfirmation: "Gespeicherte Kalender-Einstellungen wirklich löschen? Dies kann nicht rückgängig gemacht werden.",
        trimUnusedHours: "Unbenutzte Randstunden kürzen",
        trimUnusedHoursDescription: "Blendet frühe und späte Stunden ohne Termine aus.",
        daysToShow: "Anzuzeigende Tage",
        daysToShowDescription: "Begrenzt die sichtbaren Tage (1–7).",
        noCalendarsTitle: "Keine Kalender gefunden",
        noCalendarsDescription: "Home Assistant hat noch keine Kalender-Entitäten registriert, daher kann die Karte nichts anzeigen.",
        noCalendarsStepsIntro: "So löst du das Problem:",
        noCalendarsStepIntegrations: "Öffne Einstellungen → Geräte & Dienste → Integrationen.",
        noCalendarsStepAdd: "Füge eine Kalender-Integration wie Lokaler Kalender, Google Kalender, CalDAV oder einen anderen Anbieter hinzu.",
        noCalendarsStepVerify: "Warte, bis mindestens eine `calendar.*`-Entität erscheint, und kehre dann zu diesem Dashboard zurück und aktualisiere die Karte.",
        noCalendarsLinksTitle: "Brauchst du Hilfe?",
        noCalendarsOpenIntegrations: "Integrationen öffnen",
        noCalendarsReadGuide: "Setup-Anleitung lesen",
        noCalendarsRefresh: "Erneut prüfen",
        noCalendarsSettingsHint: "Du kannst die Karte über ihren eigenen Einstellungsdialog einrichten. Nutze das Zahnradsymbol in der Kopfzeile, sobald Home Assistant Kalender findet.",
        pickerLanguageHelper: "Nutze dieselbe Sprache wie Home Assistant oder wähle eine der verfügbaren Übersetzungen.",
        pickerCalendarsTitle: "Anzuzeigende Kalender",
        pickerCalendarsDescription: "Wähle, welche Kalender in dieser Karte erscheinen sollen.",
        pickerCalendarsEmpty: "Home Assistant hat noch keine Kalender bereitgestellt. Öffne Einstellungen → Geräte & Dienste → Integrationen, um einen hinzuzufügen, oder lies die Setup-Anleitung in der Dokumentation.",
        pickerCalendarsLoading: "Kalender werden gesucht…"
    },
    fr: {
        today: "Aujourd'hui",
        allDay: "Toute la journée",
        allDayShort: "Journée",
        allDayAbbrev: "Jour",
        location: "Lieu",
        description: "Description",
        calendarColors: "Couleurs du calendrier",
        supportViaPaypal: "Vous aimez la carte ?",
        saveAndClose: "Enregistrer et fermer",
        close: "Fermer",
        calendar: "Calendrier",
        start: "Début",
        end: "Fin",
        noTitle: "(sans titre)",
        languageLabel: "Langue",
        systemDefault: "Langue du système",
        supportWithPaypal: "Soutenir",
        highlightToday: "Mettre en surbrillance aujourd'hui",
        highlightTodayDescription: "Colorer la colonne d'aujourd'hui avec une couleur subtile.",
        themeLabel: "Apparence",
        themeSystem: "Suivre le système",
        themeLight: "Clair",
        themeDark: "Sombre",
        resetData: "Réinitialiser les données enregistrées",
        resetDataDescription: "Supprime les couleurs, la langue, la mise en évidence et le thème sauvegardés.",
        resetConfirmation: "Effacer les paramètres enregistrés du calendrier ? Cette action est irréversible.",
        trimUnusedHours: "Réduire les heures vides",
        trimUnusedHoursDescription: "Masque les heures matinales et tardives sans événements.",
        daysToShow: "Jours à afficher",
        daysToShowDescription: "Limitez le nombre de jours visibles (1 à 7).",
        noCalendarsTitle: "Aucun calendrier trouvé",
        noCalendarsDescription: "Home Assistant n'a pas encore enregistré d'entités de calendrier, la carte ne peut donc rien afficher.",
        noCalendarsStepsIntro: "Pour résoudre le problème :",
        noCalendarsStepIntegrations: "Ouvrez Paramètres → Appareils et services → Intégrations.",
        noCalendarsStepAdd: "Ajoutez une intégration de calendrier telle que Calendrier local, Google Calendar, CalDAV ou tout autre fournisseur utilisé.",
        noCalendarsStepVerify: "Attendez qu'au moins une entité `calendar.*` apparaisse, puis revenez sur ce tableau de bord et actualisez la carte.",
        noCalendarsLinksTitle: "Besoin d'aide ?",
        noCalendarsOpenIntegrations: "Ouvrir les intégrations",
        noCalendarsReadGuide: "Lire le guide d'installation",
        noCalendarsRefresh: "Vérifier à nouveau",
        noCalendarsSettingsHint: "Vous pouvez configurer cette carte via sa propre fenêtre de paramètres. Utilisez l'icône d'engrenage dans l'en-tête dès que Home Assistant détecte des calendriers.",
        pickerLanguageHelper: "Utilisez la même langue que Home Assistant ou choisissez l'une des traductions disponibles.",
        pickerCalendarsTitle: "Calendriers à inclure",
        pickerCalendarsDescription: "Activez les calendriers qui doivent apparaître dans cette carte.",
        pickerCalendarsEmpty: "Home Assistant n'a pas encore fourni de calendriers. Ouvrez Paramètres → Appareils et services → Intégrations pour en ajouter un ou consultez le guide d'installation dans la documentation.",
        pickerCalendarsLoading: "Recherche des calendriers…"
    },
    es: {
        today: "Hoy",
        allDay: "Todo el día",
        allDayShort: "Todo día",
        allDayAbbrev: "Día",
        location: "Ubicación",
        description: "Descripción",
        calendarColors: "Colores del calendario",
        supportViaPaypal: "¿Te gusta la tarjeta?",
        saveAndClose: "Guardar y cerrar",
        close: "Cerrar",
        calendar: "Calendario",
        start: "Inicio",
        end: "Fin",
        noTitle: "(sin título)",
        languageLabel: "Idioma",
        systemDefault: "Predeterminado del sistema",
        supportWithPaypal: "Apoyar",
        highlightToday: "Resaltar el día actual",
        highlightTodayDescription: "Sombrea la columna de hoy con un color sutil.",
        themeLabel: "Apariencia",
        themeSystem: "Usar el sistema",
        themeLight: "Claro",
        themeDark: "Oscuro",
        resetData: "Restablecer datos guardados",
        resetDataDescription: "Elimina los colores, el idioma, el resaltado y el tema guardados.",
        resetConfirmation: "¿Borrar la configuración guardada del calendario? Esta acción no se puede deshacer.",
        trimUnusedHours: "Recortar horas vacías",
        trimUnusedHoursDescription: "Oculta las horas tempranas y tardías sin eventos.",
        daysToShow: "Días a mostrar",
        daysToShowDescription: "Limita la cantidad de días visibles (1–7).",
        noCalendarsTitle: "No se encontraron calendarios",
        noCalendarsDescription: "Home Assistant todavía no ha registrado entidades de calendario, por lo que la tarjeta no puede mostrar nada.",
        noCalendarsStepsIntro: "Para solucionarlo:",
        noCalendarsStepIntegrations: "Abre Ajustes → Dispositivos y servicios → Integraciones.",
        noCalendarsStepAdd: "Añade una integración de calendario como Calendario local, Google Calendar, CalDAV u otro proveedor que utilices.",
        noCalendarsStepVerify: "Espera a que aparezca al menos una entidad `calendar.*`, luego regresa a este panel y actualiza la tarjeta.",
        noCalendarsLinksTitle: "¿Necesitas ayuda?",
        noCalendarsOpenIntegrations: "Abrir Integraciones",
        noCalendarsReadGuide: "Leer guía de configuración",
        noCalendarsRefresh: "Volver a comprobar",
        noCalendarsSettingsHint: "Puedes configurar esta tarjeta desde su propio cuadro de configuración. Usa el icono de engranaje en el encabezado cuando Home Assistant encuentre calendarios.",
        pickerLanguageHelper: "Usa el mismo idioma que Home Assistant o elige una de las traducciones disponibles.",
        pickerCalendarsTitle: "Calendarios a incluir",
        pickerCalendarsDescription: "Activa los calendarios que deben mostrarse en esta tarjeta.",
        pickerCalendarsEmpty: "Home Assistant todavía no ha proporcionado calendarios. Abre Ajustes → Dispositivos y servicios → Integraciones para añadir uno o consulta la guía de configuración en la documentación.",
        pickerCalendarsLoading: "Buscando calendarios…"
    },
    it: {
        today: "Oggi",
        allDay: "Tutto il giorno",
        allDayShort: "Tutto giorno",
        allDayAbbrev: "Giorno",
        location: "Posizione",
        description: "Descrizione",
        calendarColors: "Colori del calendario",
        supportViaPaypal: "Ti piace la card?",
        saveAndClose: "Salva e chiudi",
        close: "Chiudi",
        calendar: "Calendario",
        start: "Inizio",
        end: "Fine",
        noTitle: "(senza titolo)",
        languageLabel: "Lingua",
        systemDefault: "Predefinito di sistema",
        supportWithPaypal: "Sostieni",
        highlightToday: "Evidenzia il giorno corrente",
        highlightTodayDescription: "Colora la colonna di oggi con un colore tenue.",
        themeLabel: "Aspetto",
        themeSystem: "Come sistema",
        themeLight: "Chiaro",
        themeDark: "Scuro",
        resetData: "Reimposta i dati salvati",
        resetDataDescription: "Rimuove colori, lingua, evidenziazione e tema salvati.",
        resetConfirmation: "Eliminare le impostazioni salvate del calendario? L'operazione è irreversibile.",
        trimUnusedHours: "Riduci ore vuote",
        trimUnusedHoursDescription: "Nasconde le ore mattutine e serali senza eventi.",
        daysToShow: "Giorni da mostrare",
        daysToShowDescription: "Limita il numero di giorni visibili (1–7).",
        noCalendarsTitle: "Nessun calendario trovato",
        noCalendarsDescription: "Home Assistant non ha ancora registrato entità calendario, quindi la scheda non può mostrare nulla.",
        noCalendarsStepsIntro: "Per risolvere:",
        noCalendarsStepIntegrations: "Apri Impostazioni → Dispositivi e servizi → Integrazioni.",
        noCalendarsStepAdd: "Aggiungi un'integrazione calendario come Calendario locale, Google Calendar, CalDAV o un altro provider utilizzato.",
        noCalendarsStepVerify: "Attendi che compaia almeno un'entità `calendar.*`, poi torna a questa dashboard e aggiorna la scheda.",
        noCalendarsLinksTitle: "Hai bisogno di aiuto?",
        noCalendarsOpenIntegrations: "Apri Integrazioni",
        noCalendarsReadGuide: "Leggi la guida di configurazione",
        noCalendarsRefresh: "Controlla di nuovo",
        noCalendarsSettingsHint: "Puoi configurare questa card dalla sua finestra di impostazioni. Usa l'icona a forma di ingranaggio nell'intestazione quando Home Assistant trova i calendari.",
        pickerLanguageHelper: "Usa la stessa lingua di Home Assistant oppure scegli una delle traduzioni disponibili.",
        pickerCalendarsTitle: "Calendari da includere",
        pickerCalendarsDescription: "Attiva i calendari che devono comparire in questa card.",
        pickerCalendarsEmpty: "Home Assistant non ha ancora fornito calendari. Apri Impostazioni → Dispositivi e servizi → Integrazioni per aggiungerne uno oppure leggi la guida di configurazione nella documentazione.",
        pickerCalendarsLoading: "Ricerca dei calendari in corso…"
    },
    nl: {
        today: "Vandaag",
        allDay: "Hele dag",
        allDayShort: "Hele d.",
        allDayAbbrev: "Dag",
        location: "Locatie",
        description: "Beschrijving",
        calendarColors: "Kalenderkleuren",
        supportViaPaypal: "Vind je de kaart leuk?",
        saveAndClose: "Opslaan en sluiten",
        close: "Sluiten",
        calendar: "Agenda",
        start: "Start",
        end: "Einde",
        noTitle: "(geen titel)",
        languageLabel: "Taal",
        systemDefault: "Systeemstandaard",
        supportWithPaypal: "Steunen",
        highlightToday: "Markeer de huidige dag",
        highlightTodayDescription: "Kleur de kolom van vandaag met een subtiele kleur.",
        themeLabel: "Weergave",
        themeSystem: "Volg systeem",
        themeLight: "Licht",
        themeDark: "Donker",
        resetData: "Opgeslagen gegevens resetten",
        resetDataDescription: "Verwijdert opgeslagen kleuren, taal, markering en thema-instellingen.",
        resetConfirmation: "Opgeslagen kalenderinstellingen wissen? Dit kan niet ongedaan worden gemaakt.",
        trimUnusedHours: "Lege uren inkorten",
        trimUnusedHoursDescription: "Verbergt vroege en late uren zonder afspraken.",
        daysToShow: "Dagen om te tonen",
        daysToShowDescription: "Beperk het aantal zichtbare dagen (1–7).",
        noCalendarsTitle: "Geen agenda's gevonden",
        noCalendarsDescription: "Home Assistant heeft nog geen agenda-entiteiten geregistreerd, waardoor de kaart niets kan tonen.",
        noCalendarsStepsIntro: "Los dit op door het volgende te doen:",
        noCalendarsStepIntegrations: "Open Instellingen → Apparaten en services → Integraties.",
        noCalendarsStepAdd: "Voeg een agenda-integratie toe, zoals Lokale agenda, Google Agenda, CalDAV of een andere aanbieder.",
        noCalendarsStepVerify: "Wacht tot er minstens één `calendar.*`-entiteit verschijnt en keer dan terug naar dit dashboard om de kaart te vernieuwen.",
        noCalendarsLinksTitle: "Hulp nodig?",
        noCalendarsOpenIntegrations: "Integraties openen",
        noCalendarsReadGuide: "Setup-handleiding lezen",
        noCalendarsRefresh: "Opnieuw controleren",
        noCalendarsSettingsHint: "Je kunt de kaart instellen via het eigen instellingenvenster. Gebruik het tandwiel in de kop zodra Home Assistant agenda's vindt.",
        pickerLanguageHelper: "Gebruik dezelfde taal als Home Assistant of kies een van de beschikbare vertalingen.",
        pickerCalendarsTitle: "Kalenders om te tonen",
        pickerCalendarsDescription: "Schakel in welke kalenders in deze kaart moeten verschijnen.",
        pickerCalendarsEmpty: "Home Assistant heeft nog geen kalenders geleverd. Open Instellingen → Apparaten en services → Integraties om er een toe te voegen of lees de setup-handleiding in de documentatie.",
        pickerCalendarsLoading: "Kalenders worden opgezocht…"
    }
};

export const LANGUAGE_NAMES = {
    en: "English",
    de: "Deutsch",
    fr: "Français",
    es: "Español",
    it: "Italiano",
    nl: "Nederlands"
};

export const SUPPORTED_LANGUAGES = Object.keys(TRANSLATIONS);

export function normalizeLanguage(lang) {
    return (lang || "").toString().toLowerCase().split("-")[0];
}

export function getBrowserLanguages() {
    const languages = [];
    if (typeof navigator === "undefined") {
        return languages;
    }

    if (navigator.language) {
        languages.push(navigator.language);
    }

    if (Array.isArray(navigator.languages)) {
        navigator.languages.forEach(lang => {
            if (!languages.includes(lang)) {
                languages.push(lang);
            }
        });
    }

    return languages;
}

export function resolveLanguage(preference = "system", options = {}) {
    const {
        fallback = FALLBACK_LANGUAGE,
        supported = SUPPORTED_LANGUAGES,
        browserLanguages = getBrowserLanguages()
    } = options;

    if (preference && preference !== "system") {
        const normalizedPreference = normalizeLanguage(preference);
        if (supported.includes(normalizedPreference)) {
            return normalizedPreference;
        }
    }

    for (const lang of browserLanguages) {
        const normalized = normalizeLanguage(lang);
        if (supported.includes(normalized)) {
            return normalized;
        }
    }

    return fallback;
}

export function translate(locale, key) {
    const translations = TRANSLATIONS[locale] || TRANSLATIONS[FALLBACK_LANGUAGE];
    const fallbackTranslations = TRANSLATIONS[FALLBACK_LANGUAGE];
    return translations[key] || fallbackTranslations[key] || key;
}

export function getLanguageOptions() {
    return SUPPORTED_LANGUAGES.map(code => ({ code, label: LANGUAGE_NAMES[code] || code }));
}

export function getHassLanguageCandidate(hass) {
    if (!hass || typeof hass !== "object") {
        return null;
    }

    const candidates = [
        hass.locale && typeof hass.locale === "object" ? hass.locale.language : null,
        hass.locale && typeof hass.locale === "object" ? hass.locale.languageCode : null,
        hass.language,
        hass.selectedLanguage,
        hass.user && typeof hass.user === "object" ? hass.user.language : null
    ];

    for (const candidate of candidates) {
        if (typeof candidate === "string" && candidate.trim()) {
            return candidate;
        }
    }

    return null;
}

export function getSupportedLanguageForHass(hass) {
    const rawLanguage = getHassLanguageCandidate(hass);
    const normalized = normalizeLanguage(rawLanguage);
    if (normalized && SUPPORTED_LANGUAGES.includes(normalized)) {
        return normalized;
    }
    return FALLBACK_LANGUAGE;
}
